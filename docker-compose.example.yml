# Example Docker Compose configuration for UberSDR Multicast Relay
# This shows how to integrate the multicast relay with your existing UberSDR setup

version: '3.8'

services:
  # Multicast relay with Avahi mDNS bridge
  multicast-relay:
    build: .
    container_name: multicast-relay
    network_mode: host  # Required for mDNS bridging and multicast routing
    cap_add:
      - NET_ADMIN  # Required for multicast routing
    environment:
      # Enable/disable the relay
      - RELAY_ENABLED=true

      # Config file location
      - CONFIG_FILE=/config/config.yaml

      # Note: Network interfaces are now auto-discovered
      # - Host interface: Discovered via default route
      # - Docker bridge: Discovered from ubersdr_sdr-network
    volumes:
      # Mount UberSDR config (read-only)
      - ubersdr-config:/config:ro

      # Restart trigger coordination
      - restart-trigger:/var/run/restart-trigger

      # Docker socket for network discovery (read-only)
      - /var/run/docker.sock:/var/run/docker.sock:ro

      # Host's D-Bus socket for Avahi mDNS publishing
      - /var/run/dbus/system_bus_socket:/var/run/dbus/system_bus_socket
    restart: unless-stopped
    depends_on:
      - radiod  # Wait for radiod to start first

# Volumes (these should match your existing UberSDR setup)
volumes:
  ubersdr-config:
    external: true  # Use existing volume from UberSDR
  restart-trigger:
    external: true  # Use existing volume from UberSDR

# Notes:
# 1. This container MUST use network_mode: host to bridge mDNS
# 2. Network interfaces are now auto-discovered (no manual configuration needed)
# 3. The volumes should reference your existing UberSDR volumes
# 4. Docker socket mount is required for network discovery
# 5. D-Bus socket mount is required for mDNS publishing via host's Avahi daemon
# 6. Host's Avahi daemon must be running: systemctl status avahi-daemon
# 7. If radiod is in a different compose file, remove depends_on
